(function($){"use strict";function TagsInput(element,options){this.isInit=!0,this.itemsArray=[],this.$element=$(element),this.$element.hide(),this.isSelect="SELECT"===element.tagName,this.multiple=this.isSelect&&element.hasAttribute("multiple"),this.objectItems=options&&options.itemValue,this.placeholderText=element.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=$('<div class="bootstrap-tagsinput"></div>'),this.$input=$('<input size="1" type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.before(this.$container),this.build(options),this.isInit=!1}function makeOptionItemFunction(options,key){if("function"!=typeof options[key]){var propertyName=options[key];options[key]=function(item){return item[propertyName]}}}function makeOptionFunction(options,key){if("function"!=typeof options[key]){var value=options[key];options[key]=function(){return value}}}function htmlEncode(value){return value?htmlEncodeContainer.text(value).html():""}function doGetCaretPosition(oField){var iCaretPos=0;if(document.selection){oField.focus();var oSel=document.selection.createRange();oSel.moveStart("character",-oField.value.length),iCaretPos=oSel.text.length}else(oField.selectionStart||"0"==oField.selectionStart)&&(iCaretPos=oField.selectionStart);return iCaretPos}function keyCombinationInList(keyPressEvent,lookupList){var found=!1;return $.each(lookupList,function(index,keyCombination){if("number"==typeof keyCombination&&keyPressEvent.which===keyCombination)return found=!0,!1;if(keyPressEvent.which===keyCombination.which){var alt=!keyCombination.hasOwnProperty("altKey")||keyPressEvent.altKey===keyCombination.altKey,shift=!keyCombination.hasOwnProperty("shiftKey")||keyPressEvent.shiftKey===keyCombination.shiftKey,ctrl=!keyCombination.hasOwnProperty("ctrlKey")||keyPressEvent.ctrlKey===keyCombination.ctrlKey;if(alt&&shift&&ctrl)return found=!0,!1}}),found}var defaultOptions={tagClass:function(item){return"badge badge-info"},focusClass:"focus",itemValue:function(item){return item?item.toString():item},itemText:function(item){return this.itemValue(item)},itemTitle:function(item){return null},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!1,onTagExists:function(item,$tag){$tag.hide().fadeIn()},trimValue:!1,allowDuplicates:!1,triggerChange:!0};TagsInput.prototype={constructor:TagsInput,add:function(item,dontPushVal,options){var self=this;if(!(self.options.maxTags&&self.itemsArray.length>=self.options.maxTags)&&(!1===item||item)){if("string"==typeof item&&self.options.trimValue&&(item=$.trim(item)),"object"==typeof item&&!self.objectItems)throw"Can't add objects when itemValue option is not set";if(!item.toString().match(/^\s*$/)){if(self.isSelect&&!self.multiple&&self.itemsArray.length>0&&self.remove(self.itemsArray[0]),"string"==typeof item&&"INPUT"===this.$element[0].tagName){var delimiter=self.options.delimiterRegex?self.options.delimiterRegex:self.options.delimiter,items=item.split(delimiter);if(items.length>1){for(var i=0;i<items.length;i++)this.add(items[i],!0);return void(dontPushVal||self.pushVal(self.options.triggerChange))}}var itemValue=self.options.itemValue(item),itemText=self.options.itemText(item),tagClass=self.options.tagClass(item),itemTitle=self.options.itemTitle(item),existing=$.grep(self.itemsArray,function(item){return self.options.itemValue(item)===itemValue})[0];if(!existing||self.options.allowDuplicates){if(!(self.items().toString().length+item.length+1>self.options.maxInputLength)){var beforeItemAddEvent=$.Event("beforeItemAdd",{item:item,cancel:!1,options:options});if(self.$element.trigger(beforeItemAddEvent),!beforeItemAddEvent.cancel){self.itemsArray.push(item);var $tag=$('<span class="badge '+htmlEncode(tagClass)+(null!==itemTitle?'" title="'+itemTitle:"")+'">'+htmlEncode(itemText)+'<span class="fa-fw fas fa-minus-circle" data-role="remove"></span></span>');$tag.data("item",item),self.findInputWrapper().before($tag),$tag.after(" ");var optionExists=$('option[value="'+encodeURIComponent(itemValue)+'"]',self.$element).length||$('option[value="'+htmlEncode(itemValue)+'"]',self.$element).length;if(self.isSelect&&!optionExists){var $option=$("<option selected>"+htmlEncode(itemText)+"</option>");$option.data("item",item),$option.attr("value",itemValue),self.$element.append($option)}dontPushVal||self.pushVal(self.options.triggerChange),self.options.maxTags!==self.itemsArray.length&&self.items().toString().length!==self.options.maxInputLength||self.$container.addClass("bootstrap-tagsinput-max"),$(".typeahead, .twitter-typeahead",self.$container).length&&self.$input.typeahead("val",""),this.isInit?self.$element.trigger($.Event("itemAddedOnInit",{item:item,options:options})):self.$element.trigger($.Event("itemAdded",{item:item,options:options}))}}}else if(self.options.onTagExists){var $existingTag=$(".badge",self.$container).filter(function(){return $(this).data("item")===existing});self.options.onTagExists(item,$existingTag)}}}},remove:function(item,dontPushVal,options){var self=this;if(self.objectItems&&(item="object"==typeof item?$.grep(self.itemsArray,function(other){return self.options.itemValue(other)==self.options.itemValue(item)}):$.grep(self.itemsArray,function(other){return self.options.itemValue(other)==item}),item=item[item.length-1]),item){var beforeItemRemoveEvent=$.Event("beforeItemRemove",{item:item,cancel:!1,options:options});if(self.$element.trigger(beforeItemRemoveEvent),beforeItemRemoveEvent.cancel)return;$(".badge",self.$container).filter(function(){return $(this).data("item")===item}).remove(),$("option",self.$element).filter(function(){return $(this).data("item")===item}).remove(),-1!==$.inArray(item,self.itemsArray)&&self.itemsArray.splice($.inArray(item,self.itemsArray),1)}dontPushVal||self.pushVal(self.options.triggerChange),self.options.maxTags>self.itemsArray.length&&self.$container.removeClass("bootstrap-tagsinput-max"),self.$element.trigger($.Event("itemRemoved",{item:item,options:options}))},removeAll:function(){var self=this;for($(".badge",self.$container).remove(),$("option",self.$element).remove();self.itemsArray.length>0;)self.itemsArray.pop();self.pushVal(self.options.triggerChange)},refresh:function(){var self=this;$(".badge",self.$container).each(function(){var $tag=$(this),item=$tag.data("item"),itemValue=self.options.itemValue(item),itemText=self.options.itemText(item),tagClass=self.options.tagClass(item);if($tag.attr("class",null),$tag.addClass("badge "+htmlEncode(tagClass)),$tag.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=htmlEncode(itemText),self.isSelect){var option=$("option",self.$element).filter(function(){return $(this).data("item")===item});option.attr("value",itemValue)}})},items:function(){return this.itemsArray},pushVal:function(){var self=this,val=$.map(self.items(),function(item){return self.options.itemValue(item).toString()});self.$element.val(val,!0),self.options.triggerChange&&self.$element.trigger("change")},build:function(options){var self=this;if(self.options=$.extend({},defaultOptions,options),self.objectItems&&(self.options.freeInput=!1),makeOptionItemFunction(self.options,"itemValue"),makeOptionItemFunction(self.options,"itemText"),makeOptionFunction(self.options,"tagClass"),self.options.typeahead){var typeahead=self.options.typeahead||{};makeOptionFunction(typeahead,"source"),self.$input.typeahead($.extend({},typeahead,{source:function(query,process){function processItems(items){for(var texts=[],i=0;i<items.length;i++){var text=self.options.itemText(items[i]);map[text]=items[i],texts.push(text)}process(texts)}this.map={};var map=this.map,data=typeahead.source(query);$.isFunction(data.success)?data.success(processItems):$.isFunction(data.then)?data.then(processItems):$.when(data).then(processItems)},updater:function(text){return self.add(this.map[text]),""},matcher:function(text){return-1!==text.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(texts){return texts.sort()},highlighter:function(text){var regex=new RegExp("("+this.query+")","gi");return text.replace(regex,"<strong>$1</strong>")}}))}if(self.options.typeaheadjs){var typeaheadjs=self.options.typeaheadjs;$.isArray(typeaheadjs)||(typeaheadjs=[null,typeaheadjs]),$.fn.typeahead.apply(self.$input,typeaheadjs).on("typeahead:selected",$.proxy(function(obj,datum,name){var index=0;typeaheadjs.some(function(dataset,_index){return dataset.name===name&&(index=_index,!0)}),typeaheadjs[index].valueKey?self.add(datum[typeaheadjs[index].valueKey]):self.add(datum),self.$input.typeahead("val","")},self))}self.$container.on("click",$.proxy(function(event){self.$element.attr("disabled")||self.$input.removeAttr("disabled"),self.$input.focus()},self)),self.options.addOnBlur&&self.options.freeInput&&self.$input.on("focusout",$.proxy(function(event){0===$(".typeahead, .twitter-typeahead",self.$container).length&&(self.add(self.$input.val()),self.$input.val(""))},self)),self.$container.on({focusin:function(){self.$container.addClass(self.options.focusClass)},focusout:function(){self.$container.removeClass(self.options.focusClass)}}),self.$container.on("keydown","input",$.proxy(function(event){var $input=$(event.target),$inputWrapper=self.findInputWrapper();if(self.$element.attr("disabled"))self.$input.attr("disabled","disabled");else{switch(event.which){case 8:if(0===doGetCaretPosition($input[0])){var prev=$inputWrapper.prev();prev.length&&self.remove(prev.data("item"))}break;case 46:if(0===doGetCaretPosition($input[0])){var next=$inputWrapper.next();next.length&&self.remove(next.data("item"))}break;case 37:var $prevTag=$inputWrapper.prev();0===$input.val().length&&$prevTag[0]&&($prevTag.before($inputWrapper),$input.focus());break;case 39:var $nextTag=$inputWrapper.next();0===$input.val().length&&$nextTag[0]&&($nextTag.after($inputWrapper),$input.focus())}var textLength=$input.val().length,wordSpace=Math.ceil(textLength/5),size=textLength+wordSpace+1;$input.attr("size",Math.max(this.inputSize,size))}},self)),self.$container.on("keypress","input",$.proxy(function(event){var $input=$(event.target);if(self.$element.attr("disabled"))self.$input.attr("disabled","disabled");else{var text=$input.val(),maxLengthReached=self.options.maxChars&&text.length>=self.options.maxChars;self.options.freeInput&&(keyCombinationInList(event,self.options.confirmKeys)||maxLengthReached)&&(0!==text.length&&(self.add(maxLengthReached?text.substr(0,self.options.maxChars):text),$input.val("")),!1===self.options.cancelConfirmKeysOnEmpty&&event.preventDefault());var textLength=$input.val().length,wordSpace=Math.ceil(textLength/5),size=textLength+wordSpace+1;$input.attr("size",Math.max(this.inputSize,size))}},self)),self.$container.on("click","[data-role=remove]",$.proxy(function(event){self.$element.attr("disabled")||self.remove($(event.target).closest(".badge").data("item"))},self)),self.options.itemValue===defaultOptions.itemValue&&("INPUT"===self.$element[0].tagName?self.add(self.$element.val()):$("option",self.$element).each(function(){self.add($(this).attr("value"),!0)}))},destroy:function(){var self=this;self.$container.off("keypress","input"),self.$container.off("click","[role=remove]"),self.$container.remove(),self.$element.removeData("tagsinput"),self.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var elt=this.$input[0],container=this.$container[0];elt&&elt.parentNode!==container;)elt=elt.parentNode;return $(elt)}},$.fn.tagsinput=function(arg1,arg2,arg3){var results=[];return this.each(function(){var tagsinput=$(this).data("tagsinput");if(tagsinput)if(arg1||arg2){if(void 0!==tagsinput[arg1]){if(3===tagsinput[arg1].length&&void 0!==arg3)var retVal=tagsinput[arg1](arg2,null,arg3);else retVal=tagsinput[arg1](arg2);void 0!==retVal&&results.push(retVal)}}else results.push(tagsinput);else tagsinput=new TagsInput(this,arg1),$(this).data("tagsinput",tagsinput),results.push(tagsinput),"SELECT"===this.tagName&&$("option",$(this)).attr("selected","selected"),$(this).val($(this).val())}),"string"==typeof arg1?results.length>1?results:results[0]:results},$.fn.tagsinput.Constructor=TagsInput;var htmlEncodeContainer=$("<div />");$(function(){$("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);