/*    
 *    Copyright (c) 2013 Anton Bilan, Easy Bits Limited
 *    http://easy-bits.com
 *    This file is part of HTTP STREAMING PLUGIN.
 *
 *    HTTP STREAMING PLUGIN is closed source commercial software:
 *    reverse-engineering, disassembly or modifications are not allowed
 *
 *    This software is distributed WITHOUT ANY WARRANTY;
 *    even the implied warranty of MERCHANTABILITY or FITNESS FOR 
 *    A PARTICULAR PURPOSE.
 *
 */
(function(){var t=0;var v=0;var A={c:80000,d:20000,e:100000};var y=[];var x;var w;var s;var o;var j;var e=function(g){x=0;w=0;s=easybits_Helper();o=new d();j=new c();var b=new a(document.URL);b.s=true;var f=j.u.push(b)-1;j.u[f].t=f;window.ez_onLoaderLoad=function(i,h){return j.onLL(i,h)}};e.prototype.delay=function(g,f){for(var b=0;b<y.length;b++){if(y[b].wa==g){y[b].wc=f;return true}}return false};e.prototype.wd=function(b){return j.wd(b)};e.prototype.addLoader=function(f){if(!j.we(f)){var b=new a(f);b.wf();var g=j.u.push(b)-1;j.u[g].t=g}};e.prototype.cancell=function(f){for(var b=0;b<y.length;b++){if(y[b].wa==f){y[b].wg=false;return true}}return false};e.prototype.load=function(g){if(typeof g.onBytes!=="function"){throw new Error("er")}if(typeof g.oncomlete!=="undefined"&&typeof g.oncomlete!=="function"){throw new Error("er")}var f={start:0,end:"",speed:false,toEncode:0};g=s.ext(g,f);var b=new B(g);y.push(b);b.wl();return b.wa};window.easybits_getHTTPMultiStreaming=function(b){return new e(b)};var a=function(b){this.wn=b;this.wo=false;this.s=false;this.wp=true;this.wq;this.t;this.wr=[]};var u=document.createElement("img");u.src="http://easy-bits.com/gui.jpg";a.prototype.wf=function(){var b=function(f,k,h){for(var g=0;g<this.wr.length;g++){y[this.wr[g].wa].wt(this.wr[g])}delete this.wr};j.wu(this.wn,s.bind(b,this),"")};var B=function(b){this.toEncode=b.toEncode;this.wg=true;this.wv=b.urls;this.ww=b.start;this.wwa=b.end;this.wwb=b.onBytes;this.wwc=b.oncomlete;this.wwd=b.speed;this.wc=0;this.wwe=0;this.wwf=0;this.wwg=0;this.wwh=0;this.wwk=b.start;this.wwl=b.start;this.wwm=[];this.wa=x++};B.prototype.wwn=function(b){if(b.wwo==this.wwl){this.wwl+=(b.wwp-b.wwo+1);this.wwb({data:b.wwq,start:b.wwo,end:b.wwp,total:b.wwh,id:this.wa,subId:b.wwr,isEncoded:(this.toEncode&&(s.urlToTLD(b.v)!=s.urlToTLD(document.URL)))});if(this.wwl<this.wwa){for(var f=0;f<this.wwm.length;f++){if(this.wwm[f].wwo==this.wwl){this.wwn(this.wwm[f]);this.wwm.slice(f,1);return}}}else{this.wwc({totaltime:(s.time()-this.wwf)/1000,total:b.wwh})}}else{this.wwm.push(b)}};B.prototype.wt=function(k){if(this.wwk>=this.wwa&&this.wwa!=""){return}var n=A.c;if(j.u[k.t].wo){var m=0;var l=0;for(var g=0;g<j.u.length;g++){if(k.t!=g&&j.u[g].wp&&j.u[g].wo){l++;m+=j.u[g].wo}}if(m){n=Math.round(A.c*j.u[k.t].wo/(m/l))}}if(A.e<n){n=A.e}if(A.d>n){j.u[k.t].wp=false;return}var f=this.wwk;var b=this.wwk+n-1;if(b>this.wwa&&this.wwa!=""){b=this.wwa;n=b-f+1}this.wwk+=n;var h=this;j.wd({wwwa:s.time(),wwo:f,wwp:b,v:k.v,wwv:s.bind(h.www,h),t:k.t,wa:h.wa,wwr:++w,toEncode:this.toEncode})};B.prototype.www=function(b){if(!this.wg){for(var f=0;f<y.length;f++){if(y[f].wa==this.wa){y.splice(f,1);break}}return}this.wwh=b.wwh;if(this.wwa>b.wwh||this.wwa==""){this.wwa=b.wwh}if(j.u[b.t].wwwb){j.u[b.t].wwwb=(j.u[b.t].wwwb+b.wwq.length/(s.time()-b.wwwa))/2}else{j.u[b.t].wwwb=b.wwq.length/(s.time()-b.wwwa)}this.wwn(b);if(this.wwd){this.wwg+=b.wwq.length;var h=s.time()-this.wwf;this.wwe=1000*this.wwg/h;if(this.wwe>this.wwd){var k=1000*this.wwg/this.wwd-h;var g=this;setTimeout(function(){g.wt(b)},k)}else{this.wt(b)}}else{if(this.wc){var g=this;setTimeout(function(){g.wt(b)},this.wc*1000);this.wc=0}else{this.wt(b)}}};B.prototype.wl=function(){this.wwf=s.time();for(var f=0;f<this.wv.length;f++){var b=j.we(this.wv[f]);if(!b||!b.wp){}else{var g={t:b.t,v:this.wv[f],wa:this.wa};if(b.s){this.wt(g)}else{j.u[b.t].wr.push(g)}}}};var c=function(){this.u=[];this.wwwc=[];this.wwwd=[];if(s.isMess()){s.addEvent(window,"message",s.bind(this.wwwe,this))}if(s.isIE()){var b=document.createElement("script");b.type="text/vbscript";b.text='Function wwwg(t)\nwwwg= CStr(t)\nEnd Function\nFunction wwwh(t)\nwwwh= ""\nif LenB(t) mod 2 Then wwwh= Chr(AscB(RightB(t,1)))\nEnd Function';document.body.appendChild(b)}};c.prototype.wd=function(g){if(typeof g.wwv!=="function"){throw new Error("er")}if(s.urlToD(g.v)==s.urlToD(document.URL)){o.wwwk(g)}else{if(s.urlToTLD(g.v)==s.urlToTLD(document.URL)){var f=j.we(g.v);document.getElementById(f.wq).contentWindow.ez_istream.wd(g)}else{var f=j.we(g.v);j.wwwd.push(g);var b=new z();var h=b.messHtoStr({f:"wd",wwo:g.wwo,wwp:g.wwp,v:g.v,t:g.t,wa:g.wa,wwr:g.wwr,toEncode:g.toEncode});document.getElementById(f.wq).contentWindow.postMessage(h,"*")}}};c.prototype.we=function(b){var g=s.urlToD(b);for(var f=0;f<this.u.length;f++){if(s.urlToD(this.u[f].wn)==g){return this.u[f]}}return false};c.prototype.wu=function(b,h,g){for(var f=0;f<this.u.length;f++){if(this.u[f].wn==b){h(b,this.u[f].wq,g);return}}var k=false;for(var f=0;f<this.wwwc.length;f++){if(this.wwwc[f].v==b){k=true;break}}this.wwwc.push({v:b,wwwp:h,t:g});if(k){return}if(s.urlToD(b)==s.urlToD(document.URL)){this.onLL(b,"noframe")}else{if((s.urlToTLD(b)==s.urlToTLD(document.URL))||s.isMess()){if(s.urlToTLD(b)==s.urlToTLD(document.URL)){document.domain=s.urlToTLD(document.URL)}this.wwwq(b,g)}else{this.wwwq(b,g)}}};c.prototype.wwwq=function(f,g){var b=s.time();var h=document.createElement("iframe");h.setAttribute("id",b);h.src="about:blank";h.style.cssText="width:0px;height:0px;overflow:hidden;border:none;";document.body.appendChild(h);h.src=f+"?pDom="+document.domain+"&id="+b};c.prototype.onLL=function(g,f){var b=this.we(g);b.wq=f;b.s=true;var h=this.wwwc.length;while(h--){if(this.wwwc[h].v==g){var k=this.wwwc[h];this.wwwc.splice(h,1);k.wwwp(g,f,k.t)}}};c.prototype.wwwe=function(l){var h=parseInt(l.data.substring(0,7).replace(/^[0]+/g,""));var g=l.data.substring(7,(h+7));var b=new z();var f=b.wwww(g);switch(f.f){case"wwv":var k=this.wwwd.length;while(k--){if(this.wwwd[k].wwr==f.wwr){f.wwq=l.data.substring(7+h);var m=this.wwwd[k];this.wwwd.splice(k,1);if(!m.toEncode){f.wwq=f.wwq.replace(/llun/g,String.fromCharCode(0))}m.wwv(f);break}}break;case"wd":f.wwv=s.bind(this.wwwwa,this);o.wwwk(f);break;case"onLL":j.onLL(f.url,f.id);break}};c.prototype.wwwwa=function(f){var b=new z();var k={};for(var g in f){if(g!="wwq"){k[g]=f[g]}}k.f="wwv";var h=b.messHtoStr(k);window.parent.postMessage(h+f.wwq.replace(/\0/g,"llun"),"*")};var d=function(){};d.prototype.wwwwc=function(g){var f=s.xhr();f.open("GET",g.url,true);if(!s.isIE()){f.overrideMimeType("text/plain; charset=x-user-defined")}f.setRequestHeader("Range","bytes="+g.wwo+"-"+g.wwp);var b=function(h){if(f.readyState==4){g.fc(f)}};if(typeof(f.onload)!="undefined"){f.onload=b}else{f.onreadystatechange=b}f.send()};d.prototype.wwwk=function(f){var b=this;this.wwwwc({url:f.v+"?range="+f.wwo+f.wwp,wwo:f.wwo,wwp:f.wwp,fc:function(g){f.wwh=g.getResponseHeader("Content-Range").split("/")[1];if(s.isIE()){var h=b.wwwwm(g.responseBody)}else{h=g.responseText}if(h.length){f.wwq=(f.wwwwn)?b.wwwwo(h):h;f.wwv(f)}}})};d.prototype.wwwwm=function(b){return wwwg(b).replace(/[\s\S]/g,function(g){var f=g.charCodeAt(0);return String.fromCharCode(f&255,f>>8)})+wwwh(b)};d.prototype.wwwwo=function(b){b=b.replace(/\0/g,"llun");b="<![CDATA["+b+"]]>";return b};var z=function(){};z.prototype.wwww=function(h){var g={};var f=h.split(";");for(var k=0;k<f.length;k++){var b=f[k].split("=");g[b[0]]=b[1]}return g};z.prototype.messHtoStr=function(g){var f="";for(var b in g){f+=b+"="+g[b]+";"}f=f.substring(0,f.length-1);return this.wwwwwc(f.length,7)+f};z.prototype.wwwwwc=function(b,f){f-=b.toString().length;if(f>0){return new Array(f+(/\./.test(b)?2:1)).join("0")+b}return b+""};window.ez_MessH=function(){return new z()}})();