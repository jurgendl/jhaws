Scrollator={scrollatorElementsStack:[],refreshAll:function(){for(var i=Scrollator.scrollatorElementsStack.length;i--;)!Scrollator.scrollatorElementsStack[i].$sourceElement.closest("body").length>0?Scrollator.scrollatorElementsStack[i].destroy():Scrollator.scrollatorElementsStack[i].refresh()}},$(window).load(function(){Scrollator.refreshAll()}),function($){$.scrollator=function(sourceElement,options){var defaults={custom_class:"",zIndex:""},plugin=this;plugin.settings={};var $sourceElement=$(sourceElement);plugin.$sourceElement=$sourceElement;var $mainScrollatorHolder=null,$thisScrollatorLaneHolder=null,$thisScrollatorLane=null,$thisScrollatorHandleHolder=null,$thisScrollatorHandle=null,timerVisibility=null,isDraggingHandle=!1,dragStartY=0,dragStartScrollTop=0;plugin.init=function(){plugin.settings=$.extend({},defaults,options),$mainScrollatorHolder=$("#scrollator_holder"),$sourceElement.addClass("scrollator"),$thisScrollatorLaneHolder=$(document.createElement("div")).addClass("scrollator_lane_holder"),$thisScrollatorLaneHolder.addClass(plugin.settings.custom_class),$thisScrollatorLaneHolder.css("z-index",$sourceElement.css("z-index")),""!==plugin.settings.zIndex&&$thisScrollatorLaneHolder.css("z-index",plugin.settings.zIndex),$sourceElement.is("body")&&$thisScrollatorLaneHolder.addClass("scrollator_on_body"),$thisScrollatorLane=$(document.createElement("div")).addClass("scrollator_lane"),$thisScrollatorHandleHolder=$(document.createElement("div")).addClass("scrollator_handle_holder"),$thisScrollatorHandle=$(document.createElement("div")).addClass("scrollator_handle"),initializeMainScrollatorsHolder(),$sourceElement.bind("mousewheel DOMMouseScroll",mouseWheelEvent),$thisScrollatorLaneHolder.bind("mousewheel DOMMouseScroll",mouseWheelEvent),$thisScrollatorLane.bind("mousewheel DOMMouseScroll",mouseWheelEvent),$thisScrollatorHandleHolder.bind("mousewheel DOMMouseScroll",mouseWheelEvent),$thisScrollatorHandle.bind("mousewheel DOMMouseScroll",mouseWheelEvent),$sourceElement.bind("mousemove",mouseMoveEvent),$thisScrollatorLaneHolder.bind("mousemove",mouseMoveEvent),$thisScrollatorLane.bind("mousemove",mouseMoveEvent),$thisScrollatorHandleHolder.bind("mousemove",mouseMoveEvent),$thisScrollatorHandle.bind("mousemove",mouseMoveEvent),$thisScrollatorHandleHolder.bind("mousedown",mouseDownEvent),$thisScrollatorHandle.bind("mousedown",mouseDownEvent),$thisScrollatorHandleHolder.append($thisScrollatorHandle),$thisScrollatorLane.append($thisScrollatorHandleHolder),$thisScrollatorLaneHolder.append($thisScrollatorLane),$mainScrollatorHolder.append($thisScrollatorLaneHolder),$(window).bind("mouseup",windowMouseUpEvent),$(window).bind("mousemove",windowMouseMoveEvent),$(window).bind("keydown",windowKeyDownEvent),refreshScrollatorPosition(),document.body.hasScrollatorPageResizeEventHandler||(document.body.hasScrollatorPageResizeEventHandler=!0,$(window).bind("resize",function(){Scrollator.refreshAll()})),mouseMoveEvent()};var mouseWheelEvent=function(e){if(!e.ctrlKey&&"auto"!=$(e.target).css("overflow-y")){e.preventDefault(),e.stopPropagation();var scrollTop=($sourceElement.is("body")?$(window):$sourceElement).scrollTop(),scrollAdjust=0;void 0!==e.originalEvent.wheelDeltaY&&0!==e.originalEvent.wheelDeltaY?scrollAdjust=e.originalEvent.wheelDeltaY/1.2:void 0!==e.originalEvent.wheelDelta&&0!==e.originalEvent.wheelDelta?scrollAdjust=e.originalEvent.wheelDelta/1.2:void 0!==e.originalEvent.detail&&0!==e.originalEvent.detail&&(scrollAdjust=-33.33*e.originalEvent.detail),scrollTop+=-1*scrollAdjust,($sourceElement.is("body")?$(window):$sourceElement).scrollTop(scrollTop),Scrollator.refreshAll()}},mouseMoveEvent=function(){clearTimeout(timerVisibility),$sourceElement[0].scrollHeight>($sourceElement.is("body")?$(window).height():$sourceElement.innerHeight())?($thisScrollatorLaneHolder.css("opacity",1),timerVisibility=setTimeout(function(){$thisScrollatorLaneHolder.css("opacity",0)},1500)):$thisScrollatorLaneHolder.css("opacity",0)},mouseDownEvent=function(e){e.preventDefault(),isDraggingHandle=!0,dragStartY=e.clientY,dragStartScrollTop=($sourceElement.is("body")?$(window):$sourceElement).scrollTop(),e.offsetY,$thisScrollatorLaneHolder.addClass("hover")},windowMouseMoveEvent=function(e){if(isDraggingHandle){var draggedY=e.clientY-dragStartY,multiplier=$sourceElement[0].scrollHeight/($sourceElement.is("body")?$(window).height():$sourceElement.innerHeight());($sourceElement.is("body")?$(window):$sourceElement).scrollTop(dragStartScrollTop+draggedY*multiplier),Scrollator.refreshAll(),mouseMoveEvent()}},windowMouseUpEvent=function(){isDraggingHandle=!1,$thisScrollatorLaneHolder.removeClass("hover")},windowKeyDownEvent=function(e){var key={pageUp:33,pageDown:34};if((e.keyCode==key.pageUp||e.keyCode==key.pageDown)&&"TEXTAREA"!=$(document.activeElement).prop("tagName")){var scrollTop=($sourceElement.is("body")?$(window):$sourceElement).scrollTop(),scrollAdjust=.9*($sourceElement.is("body")?$(window).height():$sourceElement.innerHeight());e.keyCode==key.pageUp?scrollTop-=scrollAdjust:e.keyCode==key.pageDown&&(scrollTop+=scrollAdjust),($sourceElement.is("body")?$(window):$sourceElement).scrollTop(scrollTop),Scrollator.refreshAll(),mouseMoveEvent()}};plugin.refresh=function(){refreshScrollatorPosition()};var refreshScrollatorPosition=function(){var boundingClientRect=$sourceElement[0].getBoundingClientRect(),sourceBounds={left:boundingClientRect.left+$(window).scrollLeft(),top:boundingClientRect.top+$(window).scrollTop(),right:boundingClientRect.right+$(window).scrollLeft(),bottom:boundingClientRect.bottom+$(window).scrollTop(),width:boundingClientRect.width,height:boundingClientRect.height},paddingTop=parseInt($sourceElement.css("border-top-width"),10),paddingRight=parseInt($sourceElement.css("border-right-width"),10),paddingBottom=parseInt($sourceElement.css("border-bottom-width"),10),contentHeight=(parseInt($sourceElement.css("border-left-width"),10),$sourceElement[0].scrollHeight),laneHeight=$sourceElement.is("body")?$(window).height():$sourceElement.innerHeight(),handleHeight=laneHeight/contentHeight*100,handlePosition=($sourceElement.is("body")?$(window):$sourceElement).scrollTop()/contentHeight*100;$sourceElement.is("body")||$thisScrollatorLaneHolder.css({top:sourceBounds.top+paddingTop,right:-sourceBounds.right+paddingRight,bottom:-sourceBounds.bottom+paddingBottom}),$thisScrollatorHandleHolder.css({height:handleHeight+"%",top:handlePosition+"%"})},initializeMainScrollatorsHolder=function(){0===$mainScrollatorHolder.length&&($mainScrollatorHolder=$(document.createElement("div")).attr("id","scrollator_holder"),$("body").append($mainScrollatorHolder))};plugin.hide=function(){$thisScrollatorLaneHolder.hide()},plugin.show=function(){$thisScrollatorLaneHolder.show()},plugin.destroy=function(){$sourceElement.removeClass("scrollator"),$.removeData(sourceElement,"scrollator"),$sourceElement.unbind("mousewheel DOMMouseScroll",mouseWheelEvent),$sourceElement.unbind("mousemove",mouseMoveEvent),$(window).unbind("mouseup",windowMouseUpEvent),$(window).unbind("mousemove",windowMouseMoveEvent),$(window).unbind("keydown",windowKeyDownEvent),$thisScrollatorLaneHolder.remove();for(var i=Scrollator.scrollatorElementsStack.length;i--;)Scrollator.scrollatorElementsStack[i]===plugin&&Scrollator.scrollatorElementsStack.splice(i,1);0===$mainScrollatorHolder.children().length&&($mainScrollatorHolder.remove(),$mainScrollatorHolder=null)},plugin.init()},$.fn.scrollator=function(options){return options=void 0!==options?options:{},this.each(function(){if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))if("object"==typeof options){if(void 0===$(this).data("scrollator")){var plugin=new $.scrollator(this,options);Scrollator.scrollatorElementsStack.push(plugin),$(this).data("scrollator",plugin)}}else $(this).data("scrollator")[options]?$(this).data("scrollator")[options].apply(this,Array.prototype.slice.call(arguments,1)):$.error("Method "+options+" does not exist in $.scrollator")})}}(jQuery);